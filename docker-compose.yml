services:
  # ============================================
  # wiz Server (connects to ROS2 network)
  # ============================================
  wiz-server-humble:
    build:
      context: .
      dockerfile: docker/Dockerfile.humble
    image: wiz-server:humble
    ports:
      - "9090:9090"
    environment:
      - ROS_DOMAIN_ID=${ROS_DOMAIN_ID:-0}
    # Uncomment to enable cyclonedds
    # volumes:
    #   - ./cyclonedds.xml:/etc/cyclonedds/cyclonedds.xml
    # environment:
    #   - CYCLONEDDS_URI=file:///etc/cyclonedds/cyclonedds.xml

  wiz-server-jazzy:
    build:
      context: .
      dockerfile: docker/Dockerfile.jazzy
    image: wiz-server:jazzy
    ports:
      - "9090:9090"
    environment:
      - ROS_DOMAIN_ID=${ROS_DOMAIN_ID:-0}

  # ============================================
  # TurtleBot3 Gazebo Simulation (for testing)
  # ============================================
  gazebo-turtlebot3:
    build:
      context: .
      dockerfile: docker/Dockerfile.gazebo
    image: wiz-gazebo:humble
    environment:
      - ROS_DOMAIN_ID=${ROS_DOMAIN_ID:-0}
      - DISPLAY=${DISPLAY:-:0}
      - TURTLEBOT3_MODEL=waffle_pi
      - QT_X11_NO_MITSHM=1
    volumes:
      - /tmp/.X11-unix:/tmp/.X11-unix:rw
    profiles:
      - example

networks:
  default:
    driver: bridge
